@page "/"
@layout EmptyLayout
@using Microsoft.AspNetCore.Components.Authorization
@inject NavigationManager Navigation

<AuthorizeView>
    <Authorized>
        <div class="d-flex justify-content-center align-items-center" style="min-height: 100vh;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
        </div>
    </Authorized>
    <NotAuthorized>
        <div class="landing-container">
            <div class="landing-content">
                <div class="glass-panel p-5 text-center fade-in-up">
                    <div class="mb-4 d-inline-flex align-items-center justify-content-center bg-primary bg-opacity-10 p-3 rounded-circle text-primary">
                        <span class="bi bi-graph-up" style="font-size: 2rem;"></span>
                    </div>
                    <h1 class="display-5 fw-bold mb-2 text-dark">Verity CashFlow</h1>
                    <p class="text-muted mb-4 lead">Gest√£o financeira inteligente e profissional.</p>
                    
                    <a href="authentication/login" class="btn btn-primary btn-lg w-100 shadow-lg mb-3">
                        <span class="bi bi-box-arrow-in-right me-2"></span> Entrar no Sistema
                    </a>
                </div>
                
                <div class="text-center mt-4 text-white-50 small">
                    &copy; @DateTime.Now.Year Verity Cashflow. Todos os direitos reservados.
                </div>
            </div>
        </div>

        <style>
            .landing-container {
                min-height: 100vh;
                width: 100vw;
                background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #4338ca 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 1rem;
            }
            
            .landing-content {
                max-width: 480px;
                width: 100%;
            }

            .glass-panel {
                background: rgba(255, 255, 255, 0.8);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255,255,255, 0.8);
                padding: 2rem;
                border-radius: 1rem;
            }
            
            .fade-in-up {
                animation: fadeInUp 0.8s ease-out;
            }
            
            @@keyframes fadeInUp {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
        </style>
    </NotAuthorized>
</AuthorizeView>

@code {
    [CascadingParameter]
    private Task<AuthenticationState>? AuthenticationStateTask { get; set; }

    private bool _hasRedirected = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && AuthenticationStateTask != null && !_hasRedirected)
        {
            var authState = await AuthenticationStateTask;
            if (authState.User.Identity?.IsAuthenticated == true)
            {
                _hasRedirected = true;
                Navigation.NavigateTo("/dashboard");
            }
        }
    }
}

